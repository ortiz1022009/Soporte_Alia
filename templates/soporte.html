<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Soporte T√©cnico - Alia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    html, body {
      margin: 0; padding: 0; min-height: 100vh; width: 100vw; box-sizing: border-box; overflow-x: hidden;
    }
    body {
      background: linear-gradient(120deg, #221c34 0%, #2a213d 100%);
      font-family: 'Segoe UI', 'Arial', sans-serif;
      color: #fff;
      min-height: 100vh;
      min-width: 100vw;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background .4s;
    }
    .soporte-box {
      max-width: 98vw;
      width: 100%;
      background: rgba(42,33,61,0.97);
      border-radius: 18px;
      box-shadow: 0 8px 40px 0 rgba(45,36,75,0.22);
      padding: 18px 4vw 16px 4vw;
      margin: 0 auto;
      text-align: center;
      animation: fadeIn 0.7s cubic-bezier(.42,0,.58,1);
      backdrop-filter: blur(2px);
      box-sizing: border-box;
      overflow: hidden;
      position:relative;
      min-height: 98vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    h1 {
      color: #b388ff;
      font-size: 1.6rem;
      letter-spacing: .5px;
      margin-bottom: 12px;
      font-weight: 700;
      text-shadow: 0 2px 12px #0003;
      animation: bounceIn .7s cubic-bezier(.42,0,.58,1);
    }
    @keyframes bounceIn {
      0% { opacity:0; transform: scale(0.97) translateY(20px);}
      60%{ opacity:.85; transform: scale(1.03) translateY(-10px);}
      100%{opacity:1; transform: none;}
    }
    .form-control {
      margin-bottom: 12px;
      text-align: left;
      position:relative;
    }
    label {
      color: #b388ff;
      font-weight: 500;
      font-size: 1.07rem;
      display: block;
      margin-bottom: 5px;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px 11px;
      border-radius: 10px;
      border: 1.2px solid #b388ff44;
      background: #1a1630;
      color: #fff;
      font-size: 1rem;
      transition: border 0.18s, box-shadow 0.21s, background .13s;
      outline: none;
      box-shadow: 0 1px 8px 0 #0002;
      box-sizing: border-box;
      margin-top: 1px;
    }
    input:focus, select:focus, textarea:focus {
      border: 1.5px solid #7e6fff;
      box-shadow: 0 1px 14px 0 #6e4ccf38;
      background: #271e3d;
    }
    input.invalid, select.invalid, textarea.invalid {
      border: 1.5px solid #ff6f91;
      background: #2d1a1a;
      animation: shake .13s;
    }
    @keyframes shake {
      10%, 90% { transform: translateX(-1px);}
      20%, 80% { transform: translateX(2px);}
      30%, 50%, 70% { transform: translateX(-4px);}
      40%, 60% { transform: translateX(4px);}
    }
    .tooltip-error {
      position: absolute;
      right: 10px; top: 50%;
      transform: translateY(-50%);
      color: #ff6f91;
      font-size: 0.94em;
      background: #fff1;
      padding: 2px 8px;
      border-radius: 8px;
      display: none;
      z-index: 40;
    }
    .form-control.error .tooltip-error { display: block;}
    textarea {
      min-height: 90px;
      max-height: 250px;
      resize: vertical;
    }
    .btn, .btn-clear {
      background: linear-gradient(90deg,#7e6fff 35%,#72eaff 100%);
      color: #fff;
      border: none;
      border-radius: 14px;
      padding: 12px 0;
      font-size: 1.08rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 2px 18px 0 #6e4ccf38;
      margin: 8px 0;
      transition: background 0.23s, transform 0.18s;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
      position: relative;
      display: block;
    }
    .btn:active { transform: scale(0.97);}
    .btn[disabled] {opacity: 0.7; cursor: wait;}
    .btn-clear {
      background: #271e3d;
      color: #b388ff;
      font-weight: 600;
      margin-top: 0;
      margin-bottom: 8px;
      box-shadow: none;
      font-size: 0.97em;
      border: 1px solid #b388ff47;
      transition: color .14s, border .16s;
    }
    .btn-clear:hover {color: #ff6f91; border: 1px solid #ff6f91;}
    .progressbar {
      width: 100%; height: 5px; border-radius: 6px;
      background: #2a213d;
      position: absolute; top: 0; left:0;
      overflow: hidden;
      display: none;
    }
    .progress-inner {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg,#7e6fff 35%,#72eaff 100%);
      border-radius: 6px;
      transition: width .5s cubic-bezier(.42,0,.58,1);
    }
    .priority-toggle {
      display: flex; gap: 9px; margin-bottom: 11px; align-items: center; justify-content: center;
    }
    .priority-btn {
      background: #1a1630;
      color: #ffe082;
      border: 2px solid #b388ff50;
      border-radius: 20px;
      padding: 7px 16px;
      cursor: pointer;
      font-size: 0.97em;
      font-weight: 600;
      transition: background .17s, border .15s, color .18s;
      outline: none;
      box-shadow: 0 1px 8px #0001;
      position: relative;
    }
    .priority-btn.selected, .priority-btn:focus {
      background: #7e6fff33;
      border: 2px solid #ffe082;
      color: #fff176;
    }
    .faq {
      background: #291e41;
      border-radius: 10px;
      padding: 12px 10px 9px 10px;
      margin: 14px 0 6px 0;
      color: #72eaff;
      text-align: left;
      overflow-x: auto;
      font-size: .99em;
    }
    .faq-title {
      font-size: 1.07rem;
      font-weight: 600;
      margin-bottom: 4px;
      color: #b388ff;
    }
    .faq-item {
      margin: 5px 0;
      border-bottom: 1px solid #2a213d;
      cursor: pointer;
      transition: background .16s;
      border-radius: 7px;
    }
    .faq-q {
      font-weight: 500;
      padding: 6px 4px;
      display: flex;
      align-items: center;
      gap: 7px;
      user-select: none;
      transition: color .13s;
    }
    .faq-q i { transition: transform .18s;}
    .faq-a {
      display: none;
      margin: 2px 0 0 18px;
      color: #fff;
      font-size: 1em;
      transition: all .2s;
    }
    .faq-item.open {background: #322254;}
    .faq-item.open .faq-a {display:block;}
    .faq-item.open .faq-q i {transform: rotate(90deg);}
    .links-rapidos {
      background: #23203b;
      border-radius: 10px;
      padding: 9px 4px;
      margin: 13px 0 7px 0;
      font-size: 0.95rem;
      display: flex;
      flex-wrap: wrap;
      gap: 9px;
      justify-content: center;
      align-items: center;
    }
    .links-rapidos a {
      color: #b388ff;
      font-weight: 500;
      text-decoration: underline;
      margin-right: 0;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .copy-btn {
      background: none;
      border: none;
      color: #ffe082;
      font-size: 1.1em;
      cursor: pointer;
      padding: 0 3px;
      margin-left: 0px;
      display: inline-flex;
      align-items: center;
      transition: color 0.18s;
    }
    .copy-btn:active { color: #fff176;}
    .btn-type {
      display: flex;
      gap: 6px;
      margin-bottom: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .type-btn {
      background: #1a1630;
      color: #72eaff;
      border: 2px solid #b388ff50;
      border-radius: 18px;
      padding: 6px 11px;
      font-size: 0.97em;
      cursor: pointer;
      transition: background .15s, border .14s, color .16s;
      outline: none; min-width: 38px;
      display:flex;align-items:center;gap:7px;
    }
    .type-btn.selected, .type-btn:focus {
      background: #72eaff33;
      border: 2px solid #7e6fff;
      color: #b388ff;
    }
    .type-btn i {font-size:1.11em;}
    .file-drop {
      border: 2px dashed #7e6fff50;
      border-radius: 10px;
      padding: 12px 0;
      text-align: center;
      color: #72eaff;
      margin-bottom: 11px;
      background: #23203b;
      position: relative;
      transition: border-color .18s, background .19s;
      cursor: pointer;
      font-size: .96em;
    }
    .file-drop.dragover {
      border-color: #72eaff;
      background: #291e41;
      color: #b388ff;
    }
    .file-drop input[type=file] {display:none;}
    .file-drop span {font-size:1.04em;}
    .file-name {color: #b388ff; font-size:.95em;}
    .satisfaccion {
      margin: 12px 0 0 0;
      text-align: center;
      user-select:none;
    }
    .emoji {
      font-size: 1.8rem;
      cursor: pointer;
      margin: 0 4px;
      transition: transform .13s;
      display: inline-block;
    }
    .emoji.selected {transform: scale(1.2);}
    .success, .error {
      font-size:1.01em; padding: 2px 0 5px 0; display:block;
      margin-bottom: 1px;
    }
    .success {color: #72eaff; animation: fadeIn .7s;}
    .error {color: #ff6f91;}
    .bottom-bar {
      position:fixed;left:0;bottom:0;width:100vw;
      background: #271e3d;
      color: #ffe082;
      text-align:center;
      font-size: 0.98em;
      padding: 7px 3vw 6px 3vw;
      z-index:111;
      box-shadow:0 -2px 12px #0003;
      opacity:0;pointer-events:none;
      transition:opacity .3s;
    }
    .bottom-bar.show {opacity:1;pointer-events:auto;}
    @media (max-width:600px) {
      html, body {min-width: 100vw; width: 100vw; max-width: 100vw; overflow-x: hidden;}
      .soporte-box {
        padding: 6px 1vw 5px 1vw;
        max-width: 100vw;
        width: 99vw;
        border-radius: 0;
        margin: 0;
        min-height: 100vh;
      }
      .faq {padding: 6px 1vw;}
      .btn, .btn-clear {padding: 11px 0; width: 100%; font-size: .99rem;}
      .progressbar {height: 4px;}
      h1 {font-size: 1.2rem;}
    }
    @media (max-width:380px){
      .soporte-box{padding:3px 0 3px 0;}
      .faq{padding:5px 1vw;}
      .btn-type{gap:3px;}
      .priority-toggle{gap:4px;}
      .links-rapidos{font-size: .9rem;}
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.98);}
      to { opacity: 1; transform: none;}
    }
  </style>
</head>
<body>
  <form class="soporte-box" id="soporteForm" action="/enviar_soporte" method="POST" enctype="multipart/form-data" autocomplete="off" novalidate>
    <div class="progressbar"><div class="progress-inner" id="progressInner"></div></div>
    <h1>Soporte T√©cnico Alia</h1>
    <div class="links-rapidos">
      <strong>Enlaces r√°pidos:</strong>
      <a href="mailto:soporte.alia.ia@gmail.com" id="mail-link"><i class="fas fa-envelope"></i> Correo
        <button type="button" class="copy-btn" title="Copiar correo" onclick="copiarCorreo('soporte.alia.ia@gmail.com', this)"><i class="fas fa-copy"></i></button>
      </a>
    </div>
    <div class="faq">
      <div class="faq-title">Preguntas frecuentes (FAQ):</div>
      <div class="faq-item"><div class="faq-q"><i class="fas fa-chevron-right"></i>¬øPor qu√© Alia no responde?</div>
        <div class="faq-a">Aseg√∫rate de tener conexi√≥n a Internet y que tu app est√© actualizada.</div>
      </div>
      <div class="faq-item"><div class="faq-q"><i class="fas fa-chevron-right"></i>¬øC√≥mo recupero mi contrase√±a?</div>
        <div class="faq-a">Usa la opci√≥n "¬øOlvidaste tu contrase√±a?" en la pantalla de inicio de sesi√≥n.</div>
      </div>
      <div class="faq-item"><div class="faq-q"><i class="fas fa-chevron-right"></i>¬øD√≥nde puedo descargar nuevas versiones?</div>
        <div class="faq-a">Por ahora, solo por contacto directo. Pronto estar√° disponible en tiendas oficiales.</div>
      </div>
      <div class="faq-item"><div class="faq-q"><i class="fas fa-chevron-right"></i>¬øMi consulta es privada?</div>
        <div class="faq-a">S√≠, tu mensaje solo lo recibe el desarrollador y no es compartido con terceros.</div>
      </div>
      <div class="faq-item"><div class="faq-q"><i class="fas fa-chevron-right"></i>¬øPuedo adjuntar m√°s de una imagen?</div>
        <div class="faq-a">Por ahora solo se permite una imagen por reporte. Si necesitas enviar m√°s, cont√°ctanos por correo directo.</div>
      </div>
    </div>
    <div class="priority-toggle" id="priorityToggle">
      <button type="button" class="priority-btn selected" data-value="normal" aria-label="Prioridad normal"><i class="fas fa-clock"></i> Normal</button>
      <button type="button" class="priority-btn" data-value="alta" aria-label="Prioridad alta"><i class="fas fa-exclamation"></i> Alta</button>
      <button type="button" class="priority-btn" data-value="urgente" aria-label="Prioridad urgente"><i class="fas fa-bolt"></i> Urgente</button>
      <input type="hidden" name="prioridad" id="prioridad" value="normal">
    </div>
    <div class="form-control" id="fc-nombre">
      <label for="nombre">Nombre:</label>
      <input type="text" id="nombre" name="nombre" maxlength="50" required autocomplete="name">
      <span class="tooltip-error"></span>
    </div>
    <div class="form-control" id="fc-email">
      <label for="email">Correo electr√≥nico:</label>
      <input type="email" id="email" name="email" maxlength="60" required autocomplete="email">
      <span class="tooltip-error"></span>
    </div>
    <div class="form-control">
      <label for="idusuario">ID de usuario (opcional):</label>
      <input type="text" id="idusuario" name="idusuario" maxlength="40" autocomplete="username">
    </div>
    <div class="btn-type" id="btnType">
      <button type="button" class="type-btn selected" data-value="Reporte de bug" aria-label="Reporte de bug"><i class="fas fa-bug"></i> Bug</button>
      <button type="button" class="type-btn" data-value="Sugerencia" aria-label="Sugerencia"><i class="fas fa-lightbulb"></i> Sugerencia</button>
      <button type="button" class="type-btn" data-value="Duda" aria-label="Duda"><i class="fas fa-question-circle"></i> Duda</button>
      <button type="button" class="type-btn" data-value="Problema al iniciar sesi√≥n" aria-label="Problema al iniciar sesi√≥n"><i class="fas fa-sign-in-alt"></i> Login</button>
      <button type="button" class="type-btn" data-value="Otro" aria-label="Otro"><i class="fas fa-ellipsis-h"></i> Otro</button>
      <input type="hidden" name="tipo" id="tipo" value="Reporte de bug" required>
    </div>
    <div class="form-control">
      <label for="dispositivo">Dispositivo (opcional):</label>
      <input type="text" id="dispositivo" name="dispositivo" maxlength="60" autocomplete="device">
    </div>
    <div class="form-control" id="fc-mensaje">
      <label for="mensaje">Describe tu problema, sugerencia o consulta:</label>
      <textarea id="mensaje" name="mensaje" maxlength="600" required></textarea>
      <span class="tooltip-error"></span>
    </div>
    <div class="file-drop" id="fileDrop">
      <span id="fileDropText"><i class="fas fa-cloud-upload-alt"></i> Adjunta una imagen (opcional)</span>
      <input type="file" id="captura" name="captura" accept="image/*">
      <div class="file-name" id="fileName"></div>
    </div>
    <button type="submit" class="btn" id="enviarBtn">Enviar</button>
    <button type="button" class="btn-clear" onclick="limpiarForm()">Limpiar formulario</button>
    <div id="respuesta"></div>
    <div class="satisfaccion">
      <span>¬øTe result√≥ √∫til el soporte?</span><br>
      <span class="emoji" id="emoji1" onclick="satisfaccion(1)">üòÉ</span>
      <span class="emoji" id="emoji2" onclick="satisfaccion(2)">üôÇ</span>
      <span class="emoji" id="emoji3" onclick="satisfaccion(3)">üòê</span>
      <span class="emoji" id="emoji4" onclick="satisfaccion(4)">üòû</span>
      <div id="satisMsg" style="font-size:0.97rem;margin-top:7px;"></div>
    </div>
  </form>
  <div class="bottom-bar" id="bottomBar"></div>
  <script>
    // FAQ interactivo tipo acorde√≥n
    document.querySelectorAll('.faq-item').forEach((item, i) => {
      item.addEventListener('click', function() {
        this.classList.toggle('open');
      });
    });

    // Selector visual de prioridad
    document.querySelectorAll('.priority-btn').forEach(btn => {
      btn.addEventListener('click', function(){
        document.querySelectorAll('.priority-btn').forEach(b=>b.classList.remove('selected'));
        this.classList.add('selected');
        document.getElementById('prioridad').value = this.getAttribute('data-value');
        showBar('Prioridad: '+this.textContent.trim(),2000);
      });
    });

    // Selector visual tipo consulta
    document.querySelectorAll('.type-btn').forEach(btn => {
      btn.addEventListener('click', function(){
        document.querySelectorAll('.type-btn').forEach(b=>b.classList.remove('selected'));
        this.classList.add('selected');
        document.getElementById('tipo').value = this.getAttribute('data-value');
        showBar('Tipo seleccionado: '+this.textContent.trim(),1800);
      });
    });

    // Copiar correo
    function copiarCorreo(correo, btn){
      navigator.clipboard.writeText(correo);
      btn.innerHTML = '<i class="fas fa-check"></i>';
      showBar('¬°Correo copiado!',1500);
      setTimeout(()=>{btn.innerHTML = '<i class="fas fa-copy"></i>';},1000);
    }

    // Arrastrar y soltar imagen
    const fileDrop = document.getElementById('fileDrop');
    const fileInput = document.getElementById('captura');
    const fileName = document.getElementById('fileName');
    fileDrop.addEventListener('click', ()=>fileInput.click());
    fileDrop.addEventListener('dragover', e=>{e.preventDefault();fileDrop.classList.add('dragover');});
    fileDrop.addEventListener('dragleave', ()=>fileDrop.classList.remove('dragover'));
    fileDrop.addEventListener('drop', function(e){
      e.preventDefault();
      fileDrop.classList.remove('dragover');
      if(e.dataTransfer.files.length){
        fileInput.files = e.dataTransfer.files;
        mostrarNombreArchivo();
      }
    });
    fileInput.addEventListener('change', mostrarNombreArchivo);
    function mostrarNombreArchivo(){
      if(fileInput.files.length){
        fileName.textContent = 'Archivo: '+fileInput.files[0].name;
        fileDrop.classList.add('dragover');
      } else {
        fileName.textContent = '';
        fileDrop.classList.remove('dragover');
      }
    }

    // Feedback bar
    function showBar(msg,ms){
      var bar = document.getElementById('bottomBar');
      bar.textContent = msg;
      bar.classList.add('show');
      setTimeout(()=>{bar.classList.remove('show');}, ms||1800);
    }

    // Validaci√≥n visual en tiempo real
    function validarCampo(input, showMsg=true) {
      let valid = true, msg = "";
      if (input.hasAttribute("required") && !input.value.trim()) {
        valid = false;
        msg = "Este campo es obligatorio";
      }
      if (input.type === "email" && input.value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input.value)) {
        valid = false;
        msg = "Correo no v√°lido";
      }
      input.classList.toggle("invalid", !valid);
      let fc = input.closest('.form-control');
      if(fc){
        fc.classList.toggle('error', !valid);
        if(showMsg) fc.querySelector('.tooltip-error').textContent = valid?"":msg;
      }
      return valid;
    }
    document.querySelectorAll('input,textarea').forEach(el=>{
      el.addEventListener('blur',()=>validarCampo(el));
      el.addEventListener('input',()=>validarCampo(el,false));
    });

    // Limpiar formulario
    function limpiarForm(){
      document.getElementById('soporteForm').reset();
      document.querySelectorAll('.type-btn')[0].click();
      document.querySelectorAll('.priority-btn')[0].click();
      document.getElementById('fileName').textContent='';
      showBar('Formulario limpio',1200);
      document.querySelectorAll('.form-control').forEach(fc=>{
        fc.classList.remove('error');
        if(fc.querySelector('.tooltip-error')) fc.querySelector('.tooltip-error').textContent='';
      });
    }

    // Satisfacci√≥n emojis
    function satisfaccion(val){
      document.getElementById('satisMsg').textContent = [
        "¬°Gracias por tu feedback! üòä",
        "Nos alegra ayudarte.",
        "Seguiremos mejorando.",
        "Sentimos que no fue √∫til. Escr√≠benos para mejorar."
      ][val-1];
      for(var i=1;i<=4;i++){
        document.getElementById('emoji'+i).classList.remove("selected");
      }
      document.getElementById('emoji'+val).classList.add("selected");
      showBar('¬°Gracias por valorar el soporte!',1800);
    }

    // Progreso bar
    function setProgress(val){
      let pb = document.querySelector('.progressbar');
      let inner = document.getElementById('progressInner');
      pb.style.display = 'block';
      inner.style.width = val+'%';
      if(val>=100) setTimeout(()=>pb.style.display='none', 600);
    }

    // Env√≠o del formulario
    document.getElementById('soporteForm').onsubmit = function(e){
      e.preventDefault();
      var nombre = document.getElementById('nombre');
      var email = document.getElementById('email');
      var mensaje = document.getElementById('mensaje');
      var valid = true;
      // Validaci√≥n visual
      if(!validarCampo(nombre)) {valid = false; nombre.focus();}
      if(!validarCampo(email)) {valid = false; if(valid) email.focus();}
      if(!validarCampo(mensaje)) {valid = false; if(valid) mensaje.focus();}
      if(!valid) return;

      const formData = new FormData(this);
      var btn = document.getElementById('enviarBtn');
      btn.disabled = true;
      btn.innerHTML = 'Enviando <span class="loader"></span>';
      setProgress(20);
      document.getElementById('respuesta').textContent = '';
      fetch('/enviar_soporte', {
        method: 'POST',
        body: formData
      })
      .then(res => {setProgress(60);return res.json();})
      .then(data => {
        setProgress(100);
        btn.disabled = false;
        btn.innerHTML = 'Enviar';
        let respuesta = document.getElementById('respuesta');
        if(data.status === "ok") {
          respuesta.className = "success";
          respuesta.innerHTML = '<i class="fas fa-check-circle"></i> ¬°Gracias! Tu mensaje ha sido recibido.';
          limpiarForm();
        } else {
          respuesta.className = "error";
          respuesta.innerHTML = '<i class="fas fa-times-circle"></i> Hubo un error enviando el mensaje.';
        }
      }).catch(()=>{
        setProgress(100);
        btn.disabled = false;
        btn.innerHTML = 'Enviar';
        let respuesta = document.getElementById('respuesta');
        respuesta.className = "error";
        respuesta.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error de conexi√≥n.';
      });
    };
  </script>
</body>
</html>